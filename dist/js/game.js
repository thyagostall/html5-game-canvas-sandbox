function Pong(){"use strict";function i(){m=new Image,m.onload=function(){l=!0},m.src=w,n.image=new Image,n.image.onload=function(){n.imageReady=!0,n.width=n.image.width,n.height=n.image.height,n.x=n.width,n.y=(y-n.height)/2},n.image.src=n.imageSrc,d.image=new Image,d.image.onload=function(){d.imageReady=!0,d.width=d.image.width,d.height=d.image.height,d.x=o-2*d.width,d.y=(y-n.height)/2},d.image.src=d.imageSrc,g.image=new Image,g.image.onload=function(){g.imageReady=!0,g.side=g.image.width},g.image.src=g.imageSrc,g.serve(1)}function e(){g.update(),n.update(),d.update()}function t(){l&&h.drawImage(m,0,0),h.save(),g.draw(),n.draw(),d.draw(),h.restore()}var a,h,s,n,d,g,m,o=800,y=600,r=Math.PI,c=38,u=40,l=!1,w="img/background.png";n={x:null,y:null,width:20,height:100,imageReady:!1,imageSrc:"img/paddle.png",image:null,update:function(){s[c]&&(this.y-=14),s[u]&&(this.y+=14),this.y=Math.max(Math.min(this.y,y-this.height),0)},draw:function(){this.imageReady&&h.drawImage(this.image,this.x,this.y)}},d={x:null,y:null,width:20,height:100,imageReady:!1,imageSrc:"img/paddle.png",image:null,update:function(){var i=g.y-.5*(this.height+g.side);this.y+=.1*(i-this.y),this.y=Math.max(Math.min(this.y,y-this.height),0)},draw:function(){this.imageReady&&h.drawImage(this.image,this.x,this.y)}},g={x:null,y:null,side:20,speed:12,velocity:null,imageReady:!1,imageSrc:"img/ball.png",image:null,serve:function(i){var e=Math.random();this.x=1===i?n.x+n.width:d.x-this.side,this.y=(y-this.side)*e;var t=.1*r*(1-2*e);this.velocity={x:i*this.speed*Math.cos(t),y:this.speed*Math.sin(t)}},update:function(){if(this.x+=this.velocity.x,this.y+=this.velocity.y,this.y<0||this.y+this.side>y){var i=this.velocity.y<0?0-this.y:y-(this.y+this.side);this.y+=2*i,this.velocity.y*=-1}var e=function(i,e,t,a,h,s,n,d){var g=h+n>i&&s+d>e&&i+t>h&&e+a>s;return g},t=this.velocity.x<0?n:d;if(e(t.x,t.y,t.width,t.height,this.x,this.y,this.side,this.side)){this.x=t===n?n.x+n.width:d.x-this.side;var a=(this.y+this.side-t.y)/(t.height+this.side),h=r/4*(2*a-1),s=Math.abs(h)>.2*r?1.5:1;this.velocity.x=s*(t===n?1:-1)*this.speed*Math.cos(h),this.velocity.y=s*this.speed*Math.sin(h)}(this.x+this.side<0||this.x>o)&&this.serve(t===n?1:-1)},draw:function(){this.imageReady&&h.drawImage(this.image,this.x,this.y)}},this.startGame=function(m,r){a=document.getElementById(m),a.width=o,a.height=y,h=a.getContext("2d"),s={},document.addEventListener("keydown",function(i){s[i.keyCode]=!0}),document.addEventListener("keyup",function(i){delete s[i.keyCode]}),window.addEventListener("keydown",function(i){[32,37,38,39,40].indexOf(i.keyCode)>-1&&i.preventDefault()},!1),i(),w=r+w,n.imageSrc=r+n.imageSrc,d.imageSrc=r+d.imageSrc,g.imageSrc=r+g.imageSrc;var c=function(){e(),t(),window.requestAnimationFrame(c,a)};window.requestAnimationFrame(c,a)}}